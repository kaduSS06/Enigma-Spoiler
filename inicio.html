<!doctype html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O Cofre</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

html, body {
    width: 100%;
    height: 100%;
    font-family: 'Montserrat', sans-serif;
    background: black;
    color: white;
    overflow: hidden;
    touch-action: manipulation;
}

/* ---------- VINHETA (Bordas Escuras) ---------- */
#vignette {
    position: fixed;
    inset: 0;
    background: radial-gradient(
        ellipse at center,
        transparent 30%,
        rgba(0,0,0,0.9) 100%
    );
    pointer-events: none;
    z-index: 200;
    opacity: 0;
    transition: opacity 2s ease;
}

/* ---------- PRÓLOGO ---------- */
#intro {
    position: fixed;
    inset: 0;
    background: black;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 40px;
    z-index: 100;
}

.intro-text {
    font-size: 1.4rem;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 1.5s ease, transform 1.5s ease;
    max-width: 600px;
    line-height: 1.6;
    min-height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
}

#start-btn {
    position: absolute;
    bottom: 12%;
    padding: 14px 36px;
    border: 1px solid rgba(255,255,255,0.5);
    background: transparent;
    color: white;
    border-radius: 30px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    min-height: 44px;
    min-width: 44px;
}

#start-btn:hover {
    background: rgba(255,255,255,0.1);
    border-color: rgba(255,255,255,0.8);
    transform: scale(1.05);
}

/* ---------- SALA ESCURA ---------- */
#dark-room {
    position: fixed;
    inset: 0;
    background: #050505;
    display: none;
    opacity: 0;
    pointer-events: none;
    transition: opacity 2.5s ease;
    z-index: 50;
}

/* Animação de luz falhando (Flicker) */
@keyframes flicker {
    0% { opacity: 1; }
    3% { opacity: 0.95; }
    6% { opacity: 1; }
    7% { opacity: 0.9; }
    8% { opacity: 1; }
    9% { opacity: 1; }
    10% { opacity: 0.92; }
    11% { opacity: 1; }
    100% { opacity: 1; }
}

/* ---------- LUZ DA SALA COM FLICKER ---------- */
#room-light {
    position: absolute;
    inset: 0;
    background: radial-gradient(
        circle at center,
        rgba(255, 240, 180, 0.08) 0%,
        rgba(255, 220, 140, 0.04) 25%,
        rgba(100, 80, 40, 0.01) 45%,
        transparent 70%
    );
    opacity: 0;
    transition: opacity 3s ease-in-out;
    z-index: 1;
}

.light-flickering {
    animation: flicker 7s infinite ease-in-out;
}

/* ---------- IMAGEM DO COFRE ---------- */
#chest {
    width: 240px;
    height: auto;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) scale(1);
    transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    filter: drop-shadow(0 10px 25px rgba(0, 0, 0, 0.5));
    z-index: 2;
    opacity: 0;
    transition: opacity 1.5s ease, transform 0.8s ease;
}

/* ---------- BOTÃO APROXIMAR ---------- */
#approach-button {
    position: absolute;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    padding: 14px 36px;
    border: 1px solid rgba(255,255,255,0.3);
    background: rgba(0,0,0,0.3);
    color: rgba(255,255,255,0.9);
    border-radius: 30px;
    font-size: 0.9rem;
    letter-spacing: 3px;
    cursor: pointer;
    opacity: 0;
    pointer-events: none;
    transition: all 0.4s ease;
    backdrop-filter: blur(5px);
    z-index: 3;
    min-height: 44px;
    min-width: 44px;
}

@keyframes pulse-button {
    0%, 100% { 
        opacity: 0.9;
        box-shadow: 0 0 0 rgba(255, 255, 255, 0.1);
    }
    50% { 
        opacity: 1;
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.15);
    }
}

.pulse {
    animation: pulse-button 3s ease-in-out infinite;
}

#approach-button:hover,
#approach-button:active {
    background: rgba(255,255,255,0.1);
    border-color: rgba(255,255,255,0.6);
    transform: translateX(-50%) scale(1.05);
}

/* ---------- TELA DO COFRE (Zoom) ---------- */
#vault {
    position: fixed;
    inset: 0;
    background: #0a0a0a;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 1.5s ease;
    z-index: 80;
}

/* Efeito de Respiração (Sucesso) */
@keyframes breathe {
    0% { 
        background: #0a0a0a;
    }
    50% { 
        background: #121212;
    }
    100% { 
        background: #0a0a0a;
    }
}

#vault.solved {
    animation: breathe 4s ease-in-out infinite;
}

/* ---------- TRANCAS ---------- */
.dials {
    display: flex;
    gap: 20px;
    margin-bottom: 40px;
}

.dial {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 70px;
}

.dial button {
    background: transparent;
    border: none;
    color: rgba(255,255,255,0.6);
    font-size: 1.6rem;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 12px 20px;
    border-radius: 8px;
    min-height: 44px;
    min-width: 44px;
}

.dial button:active {
    background: rgba(255,255,255,0.05);
    color: white;
    transform: scale(0.95);
}

.number {
    font-size: 2.8rem;
    margin: 12px 0;
    color: #ccc;
    font-weight: 300;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
}

/* Micro-feedback: Pop ao girar */
.number.pop {
    transform: scale(1.3);
    color: white;
}

/* Micro-feedback: Dígito correto individual */
.number.correct-digit {
    color: #d4af37;
    text-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
}

.hint {
    margin-top: 30px;
    font-size: 0.9rem;
    color: #aaa;
    opacity: 0.7;
    transition: all 0.5s ease;
}

#feedback {
    position: absolute;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1rem;
    color: #d4af37;
    opacity: 0;
    pointer-events: none;
    transition: opacity 1s ease;
    text-align: center;
    width: 80%;
    max-width: 400px;
}

audio {
    display: none;
}

/* ---------- RESPONSIVO ---------- */
@media (max-width: 768px) {
    .intro-text {
        font-size: 1.1rem;
        padding: 0 20px;
    }
    
    #start-btn {
        padding: 14px 32px;
        font-size: 1rem;
        bottom: 15%;
    }
    
    .dials {
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .dial {
        min-width: 60px;
    }
    
    .number {
        font-size: 2.2rem;
    }
    
    .dial button {
        font-size: 1.4rem;
        padding: 10px 16px;
    }
    
    #chest {
        width: 200px;
    }
    
    #approach-button {
        bottom: 70px;
        padding: 14px 32px;
    }
}
</style>
</head>
<body>
  
<div id="vignette"></div>

<audio id="ambient" src="ambiente.mp3" loop></audio>
<audio id="sfx-tick" src="tick.mp3" preload="auto"></audio>
<audio id="sfx-lock" src="lock-correct.mp3" preload="auto"></audio>
<audio id="sfx-response" src="vault-response.mp3" preload="auto"></audio>

<div id="intro">
    <div class="intro-text" id="text"></div>
    <button id="start-btn">Iniciar</button>
</div>

<div id="dark-room">
    <!-- Luz da sala -->
    <div id="room-light"></div>
    
    <img id="chest" src="cofre.png" alt="Cofre">
    <button id="approach-button" class="pulse">APROXIMAR-SE</button>
</div>

<div id="vault">
    <div class="dials" id="dials"></div>
    <div class="hint">Talvez nem tudo se abra de primeira.</div>
    <div id="feedback"></div>
</div>

<script>
const textEl = document.getElementById("text");
const intro = document.getElementById("intro");
const startBtn = document.getElementById("start-btn");
const darkRoom = document.getElementById("dark-room");
const roomLight = document.getElementById("room-light");
const approachBtn = document.getElementById("approach-button");
const chest = document.getElementById("chest");
const vault = document.getElementById("vault");
const vignette = document.getElementById("vignette");
const dials = document.getElementById("dials");
const feedback = document.getElementById("feedback");

// Áudios
const ambient = document.getElementById("ambient");
const sfxTick = document.getElementById("sfx-tick");
const sfxLock = document.getElementById("sfx-lock");
const sfxResponse = document.getElementById("sfx-response");

// Configuração de volume dos efeitos
sfxTick.volume = 0.4;
sfxLock.volume = 0.6;
sfxResponse.volume = 0.8;

// Textos do prólogo
const lines = [
    "Algumas coisas não foram feitas para serem abertas de imediato.",
    "Elas esperam.",
    "Não por tempo...",
    "Mas pela pessoa certa.",
    "Este cofre ficou aqui por muito tempo.",
    "Guardando fragmentos.",
    "Começos.",
    "Lembranças.",
    "Se você está vendo isso agora...",
    "Talvez seja porque chegou a hora de tentar."
];

let index = 0;

// Função para tocar som com segurança
function playSound(audioElement) {
    audioElement.currentTime = 0;
    audioElement.play().catch(e => console.log("Som não pôde ser tocado"));
}

// Mostrar prólogo frase por frase
function showNextLine() {
    if (index >= lines.length) {
        // Fim do prólogo
        setTimeout(() => {
            intro.style.opacity = 0;
            setTimeout(() => {
                intro.style.display = "none";

                // Entrada da Sala
                darkRoom.style.display = "block";
                vignette.style.opacity = 0.8; // Ativa vinheta

                setTimeout(() => {
                    darkRoom.style.opacity = 1;
                    darkRoom.style.pointerEvents = "auto";
                    
                    // Acender luz gradualmente com flicker
                    setTimeout(() => {
                        roomLight.style.opacity = 1;
                        roomLight.classList.add("light-flickering");
                        
                        // Mostrar cofre
                        setTimeout(() => {
                            chest.style.opacity = 1;
                        }, 500);
                        
                        // Mostrar botão de aproximação
                        setTimeout(() => {
                            approachBtn.style.opacity = 1;
                            approachBtn.style.pointerEvents = "auto";
                        }, 1500);
                    }, 300);
                }, 50);
            }, 1500);
        }, 2000);
        return;
    }

    // Esconder texto atual
    textEl.style.opacity = 0;
    textEl.style.transform = "translateY(-10px)";
    
    setTimeout(() => {
        // Mostrar nova frase
        textEl.innerText = lines[index];
        textEl.style.opacity = 1;
        textEl.style.transform = "translateY(0)";
        index++;
        
        // Chamar próxima frase
        setTimeout(showNextLine, 2800);
    }, 800);
}

// Iniciar experiência
startBtn.onclick = () => {
    // Fade in do som ambiente
    ambient.volume = 0;
    ambient.play();
    let v = 0;
    const fade = setInterval(() => {
        v += 0.02;
        ambient.volume = Math.min(v, 0.6);
        if (v >= 0.6) clearInterval(fade);
    }, 100);

    startBtn.style.display = "none";
    showNextLine();
};

/* ---------- APROXIMAÇÃO ---------- */
approachBtn.onclick = () => {
    // Zoom no cofre
    chest.style.transform = "translate(-50%, -50%) scale(1.45)";
    
    // Esconder botão
    approachBtn.style.opacity = 0;
    approachBtn.style.pointerEvents = "none";

    // Suaviza vinheta levemente ao aproximar
    vignette.style.opacity = 0.6; 

    setTimeout(() => {
        darkRoom.style.opacity = 0;
        darkRoom.style.pointerEvents = "none";

        setTimeout(() => {
            darkRoom.style.display = "none";

            vault.style.display = "flex";
            setTimeout(() => {
                vault.style.opacity = 1;
                vault.style.pointerEvents = "auto";
                vignette.style.opacity = 0.9; // Reforça vinheta no close
                
                // Criar trancas
                createDials();
            }, 50);
        }, 800);
    }, 600);
};

/* ---------- TRAVA & LÓGICA ---------- */
const PASSWORD = [6, 1, 4, 2, 9];
let values = [0, 0, 0, 0, 0];
let correctDigits = [false, false, false, false, false];
let isSolved = false;

// Criar trancas
function createDials() {
    dials.innerHTML = "";
    
    values.forEach((_, i) => {
        const dial = document.createElement("div");
        dial.className = "dial";
        dial.id = `dial-${i}`;

        const up = document.createElement("button");
        up.innerText = "▲";
        up.addEventListener("click", () => update(i, 1));
        up.addEventListener("touchstart", (e) => {
            e.preventDefault();
            update(i, 1);
        });

        const num = document.createElement("div");
        num.className = "number";
        num.id = `number-${i}`;
        num.innerText = "0";

        const down = document.createElement("button");
        down.innerText = "▼";
        down.addEventListener("click", () => update(i, -1));
        down.addEventListener("touchstart", (e) => {
            e.preventDefault();
            update(i, -1);
        });

        dial.appendChild(up);
        dial.appendChild(num);
        dial.appendChild(down);
        dials.appendChild(dial);
    });
}

function update(i, delta) {
    if (isSolved) return; // Trava interação se já resolveu

    values[i] = (values[i] + delta + 10) % 10;
    const numEl = document.getElementById(`number-${i}`);
    numEl.innerText = values[i];

    // Efeito Visual: Pop (Zoom)
    numEl.classList.remove("pop");
    void numEl.offsetWidth; // Trigger reflow para reiniciar animação
    numEl.classList.add("pop");
    
    // Remover efeito pop após animação
    setTimeout(() => {
        numEl.classList.remove("pop");
    }, 300);

    // Lógica de Som e Feedback Individual
    // Se este dígito específico estiver correto:
    if (values[i] === PASSWORD[i]) {
        playSound(sfxLock);
        numEl.classList.add("correct-digit"); // Brilho sutil
        correctDigits[i] = true;
    } else {
        playSound(sfxTick);
        numEl.classList.remove("correct-digit");
        correctDigits[i] = false;
    }

    // Verifica Senha Completa
    const allCorrect = correctDigits.every(c => c);
    
    if (allCorrect && !isSolved) {
        isSolved = true;
        onSuccess();
    } else if (isSolved && !allCorrect) {
        // Se deixou de estar correta
        isSolved = false;
        vault.classList.remove("solved");
        vignette.style.opacity = 0.9;
        feedback.style.opacity = 0;
        
        // Reativar botões
        const buttons = document.querySelectorAll(".dial button");
        buttons.forEach(btn => btn.style.opacity = 1);
        
        // Restaurar hint
        const hint = document.querySelector(".hint");
        hint.innerText = "Talvez nem tudo se abra de primeira.";
        hint.style.color = "#aaa";
        hint.style.textShadow = "none";
    }
}

function onSuccess() {
    // Som de resposta
    playSound(sfxResponse);

    // Reação Visual
    vault.classList.add("solved"); // Inicia respiração do fundo
    vignette.style.transition = "opacity 3s ease";
    vignette.style.opacity = 0.4; // Clareia as bordas

    // Desabilita botões visualmente
    const buttons = document.querySelectorAll(".dial button");
    buttons.forEach(btn => {
        btn.style.opacity = 0.3;
        btn.style.pointerEvents = "none";
    });
    
    // Feedback na dica
    const hint = document.querySelector(".hint");
    hint.style.opacity = 0;
    setTimeout(() => {
        hint.innerText = "O mecanismo respondeu...";
        hint.style.opacity = 1;
        hint.style.color = "#d4af37";
        hint.style.textShadow = "0 0 10px rgba(212, 175, 55, 0.5)";
    }, 800);
    
    // Mostrar feedback adicional
    setTimeout(() => {
        feedback.textContent = "O cofre está desbloqueado. Continue...";
        feedback.style.opacity = 1;
    }, 1500);
}

// Inicializar
createDials();
</script>
</body>
</html>t = "Algo se moveu dentro do cofre...";
        document.querySelector(".hint").style.color = "#d4af37";
        
    } else if (!allCorrectNow && allCorrect) {
        // Senha deixou de estar correta
        allCorrect = false;
        feedback.style.opacity = 0;
        vault.classList.remove("breathing");
        vignette.style.opacity = 0.9;
        
        if (chest) {
            chest.classList.remove("chest-responding");
        }
        
        // Remover marcação dos dígitos corretos
        correctDigits.forEach((isCorrect, i) => {
            if (!isCorrect) {
                const numElement = document.getElementById(`number-${i}`);
                numElement.classList.remove("correct-digit");
            }
        });
    }
}

// Inicializar
createDials();
</script>
</body>
</html>