<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Enigma 5 - Memórias</title>
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Bangers&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            /* Fundo de mesa de madeira */
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://www.transparenttextures.com/patterns/wood-pattern.png'), #3e2723;
            background-blend-mode: multiply;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: 'Indie Flower', cursive;
            perspective: 1000px;
        }

        /* Container que sofre o zoom */
        #table-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            /* Visão distante padrão */
            transform: scale(0.85) rotateX(10deg) translateY(20px);
            transform-style: preserve-3d;
        }

        /* Modo escrita (Zoom IN) */
        #table-container.writing-mode {
            transform: scale(1) rotateX(0deg) translateY(0);
        }

        /* --- O CADERNO --- */
        #notebook {
            width: 90%;
            max-width: 500px;
            height: 80vh;
            background: #fdf5e6;
            background-image: radial-gradient(#d1d1d1 1px, transparent 1px);
            background-size: 20px 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6), 0 5px 15px rgba(0,0,0,0.3);
            border-radius: 15px; /* Brochura */
            padding: 50px 30px 150px 30px;
            position: relative;
            overflow-y: auto;
            scrollbar-width: none; 
            transition: box-shadow 0.3s;
        }
        #notebook::-webkit-scrollbar { display: none; }

        #paper-content {
            color: #2c3e50;
            font-size: 1.25rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .title {
            font-weight: bold;
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 30px;
            display: block;
            color: #5d4037;
            border-bottom: 2px dashed rgba(93, 64, 55, 0.2);
            padding-bottom: 10px;
        }

        /* --- UI LAYER (Balões) --- */
        .ui-layer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: flex;
            justify-content: center;
        }

        .bubble-container {
            position: absolute;
            bottom: 60px;
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .bubble {
            background: #fff;
            color: #000;
            border: 3px solid #000;
            border-radius: 20px;
            padding: 15px;
            width: 85%;
            font-family: 'Space Mono', monospace;
            font-size: 0.95rem;
            font-weight: 700;
            position: relative;
            box-shadow: 6px 6px 0 rgba(0,0,0,0.8);
            margin-bottom: 15px;
            pointer-events: all;
            display: none;
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .bubble::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 30px;
            border-width: 15px 15px 0;
            border-style: solid;
            border-color: #000 transparent;
            display: block;
            width: 0;
        }

        @keyframes pop { from { transform: scale(0.5) translateY(50px); opacity: 0; } to { transform: scale(1) translateY(0); opacity: 1; } }

        /* --- BOTÕES --- */
        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            pointer-events: all;
            width: 90%;
        }

        .btn-opt {
            background: #fff;
            color: #000;
            border: 2px solid #000;
            padding: 12px 16px;
            font-family: 'Bangers', cursive;
            font-size: 1.1rem;
            letter-spacing: 1px;
            cursor: pointer;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.8);
            transition: 0.2s;
            flex: 1 1 auto;
            text-align: center;
            border-radius: 8px;
        }

        .btn-opt:active { transform: translate(3px, 3px); box-shadow: 1px 1px 0 rgba(0,0,0,0.8); }

        #name-input-area {
            display: none;
            margin-top: 10px;
            pointer-events: all;
            background: #fff;
            padding: 8px;
            border: 2px solid #000;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.8);
            border-radius: 8px;
        }

        input {
            border: none;
            padding: 8px;
            font-family: 'Space Mono';
            font-weight: bold;
            font-size: 1rem;
            outline: none;
            width: 150px;
        }
        
        .digit-reveal {
            font-family: 'Space Mono', monospace;
            font-weight: bold;
            font-size: 3rem;
            text-align: center;
            margin-top: 30px;
            color: #d32f2f;
            display: block;
        }
    </style>
</head>
<body>

    <div id="table-container">
        <div id="notebook">
            <div id="paper-content"></div>
        </div>
    </div>

    <div class="ui-layer">
        <div class="bubble-container">
            <div id="henrique-bubble" class="bubble"></div>
            <div id="interaction-area" class="options"></div>
            
            <div id="name-input-area">
                <input type="text" id="larissa-name" placeholder="Eu sou..." autocomplete="off">
                <button class="btn-opt" onclick="submitName()" style="box-shadow: none; border: none; border-left: 2px solid #000; border-radius: 0;">Enviar</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURAÇÕES ---
        const paper = document.getElementById('paper-content');
        const bubble = document.getElementById('henrique-bubble');
        const interaction = document.getElementById('interaction-area');
        const nameArea = document.getElementById('name-input-area');
        const notebook = document.getElementById('notebook');
        const tableContainer = document.getElementById('table-container');
        
        let userName = "Larissa";

        // --- ÁUDIO SINTETIZADO (Web Audio API) ---
        let audioCtx;
        let isWriting = false;

        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playScratchSound() {
            if (!audioCtx || !isWriting) return;
            // Cria um som de ruído branco filtrado para parecer papel raspando
            const bufferSize = audioCtx.sampleRate * 0.1; // 100ms
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }

            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = 800;
            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);

            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            noise.start();
        }

        // --- ESCRITA NO PAPEL ---
        function typeInPaper(text, isTitle = false, callback) {
            initAudio();
            isWriting = true;
            tableContainer.classList.add('writing-mode');

            let i = 0;
            const span = document.createElement('span');
            if(isTitle) span.className = 'title';
            if(!isTitle && paper.innerHTML !== "") span.innerHTML = "<br><br>";
            paper.appendChild(span);
            
            notebook.scrollTop = notebook.scrollHeight;

            const interval = setInterval(() => {
                if(Math.random() > 0.5) playScratchSound(); // Som intermitente
                span.innerHTML += text.charAt(i);
                i++;
                notebook.scrollTop = notebook.scrollHeight;
                if (i >= text.length) {
                    clearInterval(interval);
                    isWriting = false;
                    if(callback) {
                        setTimeout(() => {
                            tableContainer.classList.remove('writing-mode');
                            setTimeout(callback, 800);
                        }, 500);
                    }
                }
            }, 40);
        }

        function talk(text, options = []) {
            bubble.style.display = "block";
            bubble.innerHTML = `<strong>Henrique:</strong> ${text}`;
            interaction.innerHTML = "";
            
            if(options.length > 0) {
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = "btn-opt";
                    btn.innerText = opt.label;
                    btn.onclick = () => {
                        bubble.style.display = "none";
                        interaction.innerHTML = "";
                        opt.action();
                    };
                    interaction.appendChild(btn);
                });
            }
        }

        // --- FLUXO DA HISTÓRIA ---

        // ATO 1: Abertura
        window.onload = () => {
            setTimeout(() => {
                typeInPaper("Alice e Henrique — Uma amizade improvável em Harvard (por Henrique)", true, () => {
                    talk("Espera... tem alguém aí? Eu... eu não esperava visitas agora. Quem é você? Como você entrou aqui?", [
                        { label: "Responder...", action: () => { nameArea.style.display = "flex"; } }
                    ]);
                });
            }, 1000);
        };

        function submitName() {
            const inputVal = document.getElementById('larissa-name').value;
            userName = inputVal.trim() !== "" ? inputVal : "Larissa";
            nameArea.style.display = "none";
            initAudio(); // Garante inicialização do áudio com interação do usuário
            talk(`${userName}? Que engraçado, você me lembra muito a Alice...`, [
                { label: "Alice? Quem é essa?", action: introAlice },
                { label: "Cadê o dígito?", action: responderDigito },
                { label: "Esperar em silêncio...", action: introSilencio }
            ]);
        }

        function responderDigito() {
            talk("Que dígito? Não sei de nenhum. Só sei que este sistema guarda memórias.", [
                { label: "Quem é Alice?", action: introAlice },
                { label: "Esperar em silêncio...", action: introSilencio }
            ]);
        }
        function introSilencio() {
            talk("Você se parece mesmo com ela, acho que posso confiar em você então... Quer acompanhar a história?", [
                { label: "Sim, quero acompanhar!", action: comecarHistoria },
                { label: "Não, eu não quero saber...", action: forcarHistoria }
            ]);
        }
        function introAlice() {
            talk("Alice é a minha melhor amiga, ia escrever agora a nossa história da nossa amizade. Quer acompanhar?", [
                { label: "Sim, quero acompanhar!", action: comecarHistoria },
                { label: "Não, eu não quero saber...", action: forcarHistoria }
            ]);
        }
        function forcarHistoria() {
            talk("Não quer?? Vai acompanhar sim!", [
                { label: "Tá bom...", action: comecarHistoria }
            ]);
        }

        // ATO 2: Introdução e Perfil
        function comecarHistoria() {
            const txt = "Bom, como eu ia dizendo...\n\nHenrique (eu), sou uma pessoa bem introvertida e tímida, prefiro observar e ouvir do que falar. Até que sou inteligente, para algumas coisas, mas absurdamente inteligente, com certeza não. Me considero bem compreensível, sempre escuto as pessoas.\n\nApesar disso, eu sempre me senti perdido, não sabia ao certo o que fazer, sempre tento chegar em uma resposta, porém, nunca dá certo. Até que chega uma oportunidade de um curso em Harvard, chamado 'Projeto de Vida', ele prometia ajudar as pessoas a se encontrarem... Então decidi me inscrever.\n\nUns dias antes, em um final de semana, vou na casa de Giovanna (minha prima) e de seu futuro esposo...";
            typeInPaper(txt, false, () => {
                talk("...", [
                    { label: "Tá, mas cadê a Alice nessa história?", action: reagirAlice },
                    { label: "E você achou a resposta nesse curso?", action: reagirResposta }
                ]);
            });
        }

        function reagirAlice() {
            talk("Meu Deus, calma. Ela já vai aparecer. Você parece mesmo ela...", [
                { label: "Continua...", action: historiaEncontro }
            ]);
        }
        function reagirResposta() {
            talk(`Está pulando etapas, ${userName}. Mas eu diria que não exatamente, você vai me entender. Posso continuar?`, [
                { label: "Tá bom, continua.", action: historiaEncontro }
            ]);
        }

        // ATO 3: O Encontro e a Personalidade
        function historiaEncontro() {
            const txt = "Nesse jantar acabo comentando com o Lúcio que eu iria fazer um curso em Harvard. Ele perguntou qual curso era, eu falo 'Projeto de Vida', e então ele fala que achava que era o mesmo curso que Giovanna faria.\n\nEntão mais tarde daquele noite, Giovanna decide ligar para Alice, chamando ela para fazer o curso. As duas conversam, e pelo o que parece, Alice iria fazer esse curso também...\n\nAlice era uma pessoa 'energética', ligada no 220, ela iluminava o ambiente que estava. Ela é extrovertida, sempre com um olhar curioso. Amava Medicina em Harvard. Outra paixão eram os livros e as séries. Completamente o oposto de mim. Alice ia atrás, Henrique nem tanto.";
            typeInPaper(txt, false, () => {
                talk("...", [
                    { label: "Ligada no 220v? Achava ela cansativa?", action: reagir220 },
                    { label: "Realmente, são bem diferentes...", action: reagirDiferente },
                    { label: "E por que você não ia atrás também?", action: reagirMedo }
                ]);
            });
        }

        function reagir220() {
            talk("Nãooo! Não mesmo! É um elogio, o jeito dela cativava, muito diferente do meu.", [
                { label: "Ah bom, achei que estava falando mal.", action: () => talk("Nunca! Longe de mim isso. Vou continuar.", [{label:"Continuar", action: historiaAdaptacao}]) },
                { label: "Quanto elogio, acho que é falso!", action: () => talk(`Meu Deus, você é igual a ela... Deixa eu continuar, ${userName}.`, [{label:"Continuar", action: historiaAdaptacao}]) }
            ]);
        }
        function reagirDiferente() {
            talk("Muito. Mas acho que era exatamente disso que eu precisava. Alguém que não tivesse medo de ir atrás, já que eu passava tempo demais pensando em como ir.", [{label:"Continuar", action: historiaAdaptacao}]);
        }
        function reagirMedo() {
            talk(`Não sei muito bem. Acho que era medo da mudança. Mas a Alice e Giovanna me ajudaram muito. Você vai ver, ${userName}.`, [{label:"Continuar", action: historiaAdaptacao}]);
        }

        // ATO 4: Adaptação e Perguntas Aleatórias
        function historiaAdaptacao() {
            const txt = "Antes de chegar no curso é preciso falar uma coisa sobre Henrique... Ele sempre tentou se 'adaptar' as pessoas, para ter amizades, muitas vezes tentava se encaixar em uma coisa que não era. Uma vez até escutou 'isso é a sua cara...', aquilo não tinha nada a ver com ele. \n\nEle considerava que por conta desse jeito de 'fazer' amizades, acabou se perdendo. Então no ano do curso fez uma promessa: 'eu não vou me esforçar para fazer amigos, quero tentar ser eu mesmo'. Mas como é ser eu mesmo?\n\nLogo nos primeiros encontros Henrique percebeu que a Alice era oposto dele. Achou que ela a odiaria. Mas aos poucos Alice foi puxando assunto com leveza. Do nada, no meio de uma pesquisa sobre propósito de vida ela perguntou:\n— Henrique, você prefere morrer queimado num vulcão ou com um tiro na cabeça?\n\nOu até mesmo:\n— Se vocês fossem uma fruta, qual acham que seria? Eu acho que seria uma amora ou um tomate cereja.";
            typeInPaper(txt, false, () => {
                talk(`Eu passei a vida toda sem falar nada ou apenas dizendo 'sim' para outros, não queria incomodar... Porém elas, sempre me 'forçaram' a ter uma opinião. ${userName}, você nem imagina o quanto eu ficava travado no começo...`, [
                    { label: "Parece que você estava pedindo licença para existir.", action: respLicenca },
                    { label: "Elas só queriam saber o que passava na sua cabeça!", action: respCabeca },
                    { label: "Aposto que você teve ótimas opiniões.", action: respEmpurrao }
                ]);
            });
        }

        function respLicenca() {
            talk("Ei, não exagere, mas em partes talvez você esteja até certa. Eu tinha a ideia de que o que eu pensava não tinha valor, e isso me limitava. Ainda bem que isso mudou hoje.", [{label:"Continuar", action: historiaAmizade}]);
        }
        function respCabeca() {
            talk("As vezes nada, porém muita vezes passava muita coisa, eu só não tinha coragem de soltar. Eu agradeço a paciência que elas tiveram comigo.", [{label:"Continuar", action: historiaAmizade}]);
        }
        function respEmpurrao() {
            talk("Foi um baita empurrão mesmo. As perguntas aleatórias acabaram mostrando que eu poderia me abrir.", [{label:"Continuar", action: historiaAmizade}]);
        }

        // ATO 5: Amizade Profunda e 14 Chaves
        function historiaAmizade() {
            const txt = "Só que com o tempo Henrique viria a se soltar. A espontaneidade dela foi abrindo portas dentro dele. Mas não era só isso, em trabalho de grupo, Giovanna e Alice faziam questão de perguntar a opinião de Henrique. Elas não aceitavam a concordância fácil, elas ouviam e respeitavam.\n\nAos poucos não só Alice soltava as frases aleatórias, Henrique soltava algumas também. Alice começou a mostrar tudo o que gostava: músicas, séries, livros. 'Bora assistir juntos?' Eles passaram a assistir coisas ao mesmo tempo. Henrique sem perceber, foi se apaixonando pelo mundo que ela apresentava.\n\nHenrique não sabia como desabafar, só que Alice mostrou que estava tudo bem compartilhar medos e ansiedades. Era algo puro, leal. Um segredo que estava guardado as 7 chaves, agora estava guardado a 14 chaves.";
            typeInPaper(txt, false, () => {
                talk(`Isso da chave é uma referência minha e da Alice, talvez você não entenda, ${use